import streamlit as st
import math
import os
import pandas as pd
from PIL import Image

st.set_page_config(page_title="–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∞–≤–∞—Ä—ñ–π–Ω–æ–≥–æ –∑–ª–∏–≤—É", layout="wide")

st.title("üßÆ –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Å–∏—Å—Ç–µ–º–∏ –∞–≤–∞—Ä—ñ–π–Ω–æ–≥–æ —Å–ø–æ—Ä–æ–∂–Ω–µ–Ω–Ω—è —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–∞")

st.info(r""" ***–ó–∞–≤–¥–∞–Ω–Ω—è.*** –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–æ—á–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Å–∏—Å—Ç–µ–º–∏ –∞–≤–∞—Ä—ñ–π–Ω–æ–≥–æ –∑–ª–∏–≤—É –õ–ó–† —Å–∞–º–æ–ø–ª–∏–≤–æ–º –∑ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ü–∏–ª—ñ–Ω–¥—Ä–∏—á–Ω–æ–≥–æ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–∞, —â–æ –Ω–∞–≤–µ–¥–µ–Ω–∞ –Ω–∞ —Ä–∏—Å—É–Ω–∫—É.  
–ó–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –∑–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ –æ–±“ë—Ä—É–Ω—Ç–æ–≤–∞–Ω—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–º –∑–∞—Ö–æ–¥–∏, —â–æ –∑–∞–±–µ–∑–ø–µ—á—É—é—Ç—å —É–º–æ–≤–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∞–≤–∞—Ä—ñ–π–Ω–æ–≥–æ –∑–ª–∏–≤—É.  
–í–∏–¥ —Ä—ñ–¥–∏–Ω–∏; —Ä–æ–±–æ—á–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ $t_p$, [$^o–°$]; –≥—É—Å—Ç–∏–Ω–∞ $\rho$, [$–∫–≥/–º^3$]; –æ–±‚Äô—î–º —Ä—ñ–¥–∏–Ω–∏ –≤ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ñ $V$, [$–º^3$]; —Ä–æ–±–æ—á–∏–π —Ç–∏—Å–∫ [$kPa$];  
–ø–ª–æ—â–∞ –ø–æ–ø–µ—Ä–µ—á–Ω–æ–≥–æ –ø–µ—Ä–µ—Ä—ñ–∑—É —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–∞ $F$, [$–º^2$]; –¥—ñ–∞–º–µ—Ç—Ä –∞–≤–∞—Ä—ñ–π–Ω–æ–≥–æ —Ç—Ä—É–±–æ–ø—Ä–æ–≤–æ–¥—É $d_{–≤–Ω}$, [$–º–º$]; –º–∞—Ç–µ—Ä—ñ–∞–ª –∞–≤–∞—Ä—ñ–π–Ω–æ–≥–æ —Ç—Ä—É–±–æ–ø—Ä–æ–≤–æ–¥—É; —Ç–∏–ø –ø—É—Å–∫—É —Å–∏—Å—Ç–µ–º–∏ –æ–±–∏—Ä–∞—é—Ç—å –∑–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–æ–º. """)

# –†–æ–∑–º—ñ—â–µ–Ω–Ω—è —Å—Ö–µ–º–∏
col_text, col_img = st.columns([1, 1])

with col_img:
    # –ó–∞–º—ñ–Ω—ñ—Ç—å 'Drain_Sys_Image.png' –Ω–∞ —à–ª—è—Ö –¥–æ –≤–∞—à–æ–≥–æ —Ñ–∞–π–ª—É
    base_path = os.path.dirname(__file__)
img_relative_path = os.path.join(base_path, 'Drain_Sys_Image.png')

if os.path.exists(img_relative_path):
    img = Image.open(img_relative_path)
    st.image(img)
else:
    st.warning("–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.")

st.markdown("### –¢–∞–±–ª–∏—Ü—è ‚Ññ. –ó–Ω–∞—á–µ–Ω–Ω—è –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—É –º—ñ—Å—Ü–µ–≤–æ–≥–æ –æ–ø–æ—Ä—É –≤ —Ä–∞–∑—ñ —Ä–∞–ø—Ç–æ–≤–æ–≥–æ (—Ä—ñ–∑–∫–æ–≥–æ) –∑–≤—É–∂–µ–Ω–Ω—è —Ç—Ä—É–±–æ–ø—Ä–æ–≤–æ–¥—É")


# –¢–∞–±–ª–∏—Ü—è –∫–æ–µ–Ω—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤ –æ–ø–æ—Ä—ñ–≤ —Ä–∞–ø—Ç–æ–≤–æ–≥–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è/–∑–≤—É–∂–µ–Ω–Ω—è –ø–æ—Ç–æ–∫—ñ–≤
col_d1d2_table, col_d1d2_image = st.columns([1.5, 1])

with col_d1d2_table:
    # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–¥–∞—î–º–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—É –∫–æ–ª–æ–Ω–∫–∏, —â–æ–± –≤—ñ–Ω –Ω–µ –∑–º—ñ—â—É–≤–∞–≤ –∫–æ–Ω—Ç–µ–Ω—Ç —ñ–Ω—à–æ—ó –∫–æ–ª–æ–Ω–∫–∏
    st.markdown("**–¢–∞–±–ª–∏—Ü—è** –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ –∑–≤—É–∂–µ–Ω–Ω—è")
    data = {
        r"$d_2/d_1$": ["0,1", "0,2", "0,3", "0,4", "0,5", "0,6", "0,7", "0,8", "0,9", "1,0"],
        r"$\xi_{–≤–Ω. –∑–≤—É–∂.}$": ["0,5", "0,49", "0,46", "0,43", "0,4", "0,35", "0,29", "0,22", "0,14", "0"]
    }
    df = pd.DataFrame(data).set_index(r"$d_2/d_1$").T
    st.table(df)

with col_d1d2_image:
    try:
        image = Image.open('Flow_Narrowing.png')
        
        # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ CSS –¥–ª—è —Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è
        st.markdown('<div style="display: flex; justify-content: center;">', unsafe_allow_html=True)
        st.image(image, caption="–†–∏—Å—É–Ω–æ–∫. –†–∞–ø—Ç–æ–≤–µ –∑–≤—É–∂–µ–Ω–Ω—è –ø–æ—Ç–æ–∫—É", width=250)
        st.markdown('</div>', unsafe_allow_html=True)
    except FileNotFoundError:
        st.warning("–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.")
# –°—Ç–≤–æ—Ä—é—î–º–æ DataFrame
df = pd.DataFrame(data)

# –¢—Ä–∞–Ω—Å–ø–æ–Ω—É—î–º–æ —Ç–∞–±–ª–∏—Ü—é, —â–æ–± –≤–æ–Ω–∞ –≤–∏–≥–ª—è–¥–∞–ª–∞ —è–∫ —É –≤–∞—à–æ–º—É –∑–∞–ø–∏—Ç—ñ (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ)
df_horizontal = df.set_index("$d_2/d_1$").T

# –í–∏–≤–æ–¥–∏–º–æ —Ç–∞–±–ª–∏—Ü—é –≤ Streamlit
st.table(df_horizontal)

with col_text:
    st.markdown("""
    ### –ì–µ–æ–º–µ—Ç—Ä–∏—á–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –Ω–∞ —Å—Ö–µ–º—ñ:
    * **1** ‚Äî –ê–ø–∞—Ä–∞—Ç, —â–æ —Å–ø–æ—Ä–æ–∂–Ω—é—î—Ç—å—Å—è (—Ä–µ–∑–µ—Ä–≤—É–∞—Ä)
    * **4** ‚Äî –ê–≤–∞—Ä—ñ–π–Ω–∏–π —Ç—Ä—É–±–æ–ø—Ä–æ–≤—ñ–¥
    * **5** ‚Äî –ì—ñ–¥—Ä–æ–∑–∞—Ç–≤–æ—Ä (–≤—Ä–∞—Ö–æ–≤–∞–Ω–æ —è–∫ –º—ñ—Å—Ü–µ–≤–∏–π –æ–ø—ñ—Ä $\\xi_–≥ = 3$)
    * **6** ‚Äî –ê–≤–∞—Ä—ñ–π–Ω–∞ —î–º–Ω—ñ—Å—Ç—å (–ø—ñ–¥–∑–µ–º–Ω–∞)
    * **$H_1$** ‚Äî –ü–æ–≤–Ω–∞ –≤–∏—Å–æ—Ç–∞ –≤—ñ–¥ —Ä—ñ–≤–Ω—è —Ä—ñ–¥–∏–Ω–∏ –¥–æ –≤—Ö–æ–¥—É –≤ –∞–≤–∞—Ä—ñ–π–Ω—É —î–º–Ω—ñ—Å—Ç—å
    * **$H_2$** ‚Äî –í–∏—Å–æ—Ç–∞ –≤—ñ–¥ –¥–Ω–∞ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–∞ –¥–æ –≤—Ö–æ–¥—É –≤ –∞–≤–∞—Ä—ñ–π–Ω—É —î–º–Ω—ñ—Å—Ç—å
    """)

# –°–µ–∫—Ü—ñ—è 1: –ì–µ–æ–º–µ—Ç—Ä—ñ—è —Ç–∞ –æ–±'—î–º
with st.expander("–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–∞ —Ç–∞ –ì—ñ–¥—Ä–∞–≤–ª—ñ–∫–∞", expanded=True):
    Vp = st.number_input("–†–æ–±–æ—á–∏–π –æ–±'—î–º —Ä—ñ–¥–∏–Ω–∏ $V_p$, –º¬≥", value=15.0)
    F_res = st.number_input("–ü–ª–æ—â–∞ –ø–µ—Ä–µ—Ä—ñ–∑—É —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–∞ $F_{res}$, –º¬≤", value=5.0)
    H1 = st.number_input("–í–∏—Å–æ—Ç–∞ $H_1$ (–ø–æ—á–∞—Ç–æ–∫ –∑–ª–∏–≤—É), –º", value=4.0)
    H2 = st.number_input("–í–∏—Å–æ—Ç–∞ $H_2$ (–∫—ñ–Ω–µ—Ü—å –∑–ª–∏–≤—É), –º", value=0.5)
    d_–≤–Ω = st.number_input("–í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π –¥—ñ–∞–º–µ—Ç—Ä —Ç—Ä—É–±–∏ $d_{–≤–Ω}$, –º", value=0.1)

# –°–µ–∫—Ü—ñ—è 2: –ß–∞—Å–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
with st.expander("–ß–∞—Å–æ–≤—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è"):
    tau_–∑–ª = st.number_input("–î–æ–ø—É—Å—Ç–∏–º–∞ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å [$\tau$]–∑–ª, —Å", value=900)
    t_oper = st.number_input("–ß–∞—Å –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—è –≤ –¥—ñ—é  $\tau_{oper}$, —Å", value=300)

# –°–µ–∫—Ü—ñ—è 3: –í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ —Ä—ñ–¥–∏–Ω–∏
with st.expander("–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ —Ä—ñ–¥–∏–Ω–∏"):
    œÅ = st.number_input("–ì—É—Å—Ç–∏–Ω–∞ —Ä—ñ–¥–∏–Ω–∏ œÅ, –∫–≥/–º¬≥", value=790.5)
    Œº = st.number_input("–î–∏–Ω–∞–º—ñ—á–Ω–∞ –≤'—è–∑–∫—ñ—Å—Ç—å Œº, –ü–∞¬∑—Å", value=0.34)

# --- –†–û–ó–†–ê–•–£–ù–ö–û–í–ê –ß–ê–°–¢–ò–ù–ê ---

st.markdown(""" ### 1. –û–±—Ä–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –º—ñ—Å—Ü–µ–≤–∏—Ö –æ–ø–æ—Ä—ñ–≤ –∑ —Ç–∞–±–ª–∏—Ü—ñ """)
st.markdown(""" –û–ø–∏—Å —Ç–∞ –ø–µ—Ä–µ–ª—ñ–∫ –º—ñ—Å—Ü–µ–≤–∏—Ö –æ–ø–æ—Ä—ñ–≤ """)
col_text1, col_img1 = st.columns([1, 1])
with col_img1:
    try:
        image = Image.open('tube_knee.png')
        st.image(image, caption="–ö–æ–ª—ñ–Ω–æ —Ç—Ä—É–±–∏", width=300)
    except FileNotFoundError:
        st.warning("–ü–æ–º–∏–ª–∫–∞ —ñ–∑ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º –∫–æ–ª—ñ–Ω–æ–º.")
with col_text1:
    st.markdown("""
    ### –ó–Ω–∞—á–µ–Ω–Ω—è –º—ñ—Å—Ü–µ–≤–∏—Ö –æ–ø–æ—Ä—ñ–≤ –¥–ª—è –∫–æ–ª—ñ–Ω–∞:
    * **1** ‚Äî –ê–ø–∞—Ä–∞—Ç, —â–æ —Å–ø–æ—Ä–æ–∂–Ω—é—î—Ç—å—Å—è (—Ä–µ–∑–µ—Ä–≤—É–∞—Ä)
    * **4** ‚Äî –ê–≤–∞—Ä—ñ–π–Ω–∏–π —Ç—Ä—É–±–æ–ø—Ä–æ–≤—ñ–¥
    * **5** ‚Äî –ì—ñ–¥—Ä–æ–∑–∞—Ç–≤–æ—Ä (–≤—Ä–∞—Ö–æ–≤–∞–Ω–æ —è–∫ –º—ñ—Å—Ü–µ–≤–∏–π –æ–ø—ñ—Ä $\\xi_–≥ = 3$)
    * **6** ‚Äî –ê–≤–∞—Ä—ñ–π–Ω–∞ —î–º–Ω—ñ—Å—Ç—å (–ø—ñ–¥–∑–µ–º–Ω–∞)
    * **$H_1$** ‚Äî –ü–æ–≤–Ω–∞ –≤–∏—Å–æ—Ç–∞ –≤—ñ–¥ —Ä—ñ–≤–Ω—è —Ä—ñ–¥–∏–Ω–∏ –¥–æ –≤—Ö–æ–¥—É –≤ –∞–≤–∞—Ä—ñ–π–Ω—É —î–º–Ω—ñ—Å—Ç—å
    * **$H_2$** ‚Äî –í–∏—Å–æ—Ç–∞ –≤—ñ–¥ –¥–Ω–∞ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä–∞ –¥–æ –≤—Ö–æ–¥—É –≤ –∞–≤–∞—Ä—ñ–π–Ω—É —î–º–Ω—ñ—Å—Ç—å
    """)


# --- –ù–ê–í–ï–°–¢–ò –°–•–ï–ú–£ –í–ò–ë–û–†–£ –ú–Ü–°–¶–ï–í–ò–• –û–¢–í–û–†–Ü–í

# 1 & 2. –ú—ñ—Å—Ü–µ–≤—ñ –æ–ø–æ—Ä–∏
# –î—ñ–ª—è–Ω–∫–∞ 1
x_vkh = 0.2
x_z = 0.5
x_k = 0.55
x_g = 3.0
L1 = 5.5
# –î—ñ–ª—è–Ω–∫–∞ 2
L2 = 3.0
x_vikh = 1.0

# –°—É–º–∞—Ä–Ω–∏–π –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –º—ñ—Å—Ü–µ–≤–∏—Ö –æ–ø–æ—Ä—ñ–≤ (–ø—Ä–∏–∫–ª–∞–¥ –∑ –≤–∞—à–æ–≥–æ —Ç–µ–∫—Å—Ç—É)
# –§–æ—Ä–º—É–ª–∞: 1*0.2 + 1*0.5 + 2*0.55 + 1*3 + 1*1
zeta_c = (1 * x_vkh) + (1 * x_z) + (2 * x_k) + (1 * x_g) + (1 * x_vikh)

# 3. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–∞ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å
t_sp_m = tau_–∑–ª - t_oper

# 4. –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –≤–∏—Ç—Ä–∞—Ç–∏ (–ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π)
phi_syst_init = 1 / math.sqrt(zeta_c)

# 5. –î—ñ–∞–º–µ—Ç—Ä (—Ç–µ–æ—Ä–µ—Ç–∏—á–Ω–∏–π, –¥–ª—è –¥–æ–≤—ñ–¥–∫–∏)
# –§–æ—Ä–º—É–ª–∞: d = 0.758 * sqrt(Vp / (phi * t * sqrt(H1+H2)))
term_d = (Vp) / (phi_syst_init * t_sp_m * math.sqrt(H1 + H2))
d_tr_calc = 0.758 * math.sqrt(term_d)

# 6. –ü–ª–æ—â–∞ –ø–µ—Ä–µ—Ä—ñ–∑—É (–≤–∏—Ö–æ–¥—è—á–∏ –∑ –≤–≤–µ–¥–µ–Ω–æ–≥–æ d_vn)
f_tr = 0.785 * (d_vn**2)

# 7. –®–≤–∏–¥–∫—ñ—Å—Ç—å —Ä—É—Ö—É
w = 2.22 * phi_syst_init * math.sqrt(H1 + H2)

# 8. –ö—Ä–∏—Ç–µ—Ä—ñ–π –†–µ–π–Ω–æ–ª—å–¥—Å–∞
Re = (w * d_vn * rho) / mu

# 9. –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç —Ç–µ—Ä—Ç—è
if Re < 2300:
    lambda_f = 64 / Re
else:
    lambda_f = 0.3164 / (Re**0.25) # –§–æ—Ä–º—É–ª–∞ –ë–ª–∞–∑—ñ—É—Å–∞ –¥–ª—è —Ç—É—Ä–±—É–ª–µ–Ω—Ç–Ω–æ–≥–æ

# 10. –£—Ç–æ—á–Ω–µ–Ω–∏–π –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –æ–ø–æ—Ä—É —Å–∏—Å—Ç–µ–º–∏
zeta_syst = zeta_c + (lambda_f / d_vn) * (L1 + L2)

# 11. –£—Ç–æ—á–Ω–µ–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞ –≤–∏—Ç—Ä–∞—Ç–∏
phi_syst_new = 1 / math.sqrt(zeta_syst)

# 12. –ü–æ–º–∏–ª–∫–∞
error_pct = abs(phi_syst_new - phi_syst_init) / phi_syst_new * 100

# 13. –§–∞–∫—Ç–∏—á–Ω–∞ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å —Å–ø–æ—Ä–æ–∂–Ω–µ–Ω–Ω—è
# –§–æ—Ä–º—É–ª–∞: t = (2 * F * (sqrt(H1) - sqrt(H2))) / (phi * f_tr * sqrt(2 * 9.81))
g = 9.81
t_spor = (2 * F_res * (math.sqrt(H1) - math.sqrt(H2))) / (phi_syst_new * f_tr * math.sqrt(2 * g))

# --- –í–ò–í–Ü–î –†–ï–ó–£–õ–¨–¢–ê–¢–Ü–í ---

col1, col2 = st.columns(2)

with col1:
    st.subheader("üìä –ü—Ä–æ–º—ñ–∂–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏")
    st.write(f"**–°—É–º–∞—Ä–Ω–∏–π –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –º.–æ. $\zeta_c$:** {zeta_c:.2f}")
    st.write(f"**–î–æ–ø—É—Å—Ç–∏–º–∏–π —á–∞—Å –∑–ª–∏–≤—É $t_{{—Å–ø.–º}}$:** {t_sp_m} —Å")
    st.write(f"**–®–≤–∏–¥–∫—ñ—Å—Ç—å –ø–æ—Ç–æ–∫—É $w$:** {w:.3f} –º/—Å")
    st.write(f"**–ß–∏—Å–ª–æ –†–µ–π–Ω–æ–ª—å–¥—Å–∞ $Re$:** {Re:.2f}")
    st.write(f"**–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç —Ç–µ—Ä—Ç—è $\lambda$:** {lambda_f:.4f}")

with col2:
    st.subheader("‚úÖ –û—Å—Ç–∞—Ç–æ—á–Ω—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏")
    st.metric("–£—Ç–æ—á–Ω–µ–Ω–∏–π $\phi_{—Å–∏—Å—Ç}$", f"{phi_syst_new:.3f}")
    st.metric("–ü–æ–º–∏–ª–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É", f"{error_pct:.2f} %")
    
    color = "normal" if t_spor <= t_sp_m else "inverse"
    st.metric("–§–∞–∫—Ç–∏—á–Ω–∏–π —á–∞—Å –∑–ª–∏–≤—É $t_{—Å–ø–æ—Ä}$", f"{t_spor:.1f} —Å", 
              delta=f"{t_sp_m - t_spor:.1f} —Å –∑–∞–ø–∞—Å—É", delta_color=color)

st.divider()

# –î–µ—Ç–∞–ª—å–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —É —Ñ–æ—Ä–º–∞—Ç—ñ –∑–≤—ñ—Ç—É
with st.expander("–ü–æ–¥–∏–≤–∏—Ç–∏—Å—è –¥–µ—Ç–∞–ª—å–Ω–∏–π —Ö—ñ–¥ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É"):
    st.markdown(f"""
    1.  **–°—É–º–∞—Ä–Ω–∏–π –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –º—ñ—Å—Ü–µ–≤–∏—Ö –æ–ø–æ—Ä—ñ–≤:**
        $$\zeta_c = \sum N_i \\times \\xi_i = {zeta_c:.2f}$$
    2.  **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–∞ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å:**
        $$t_{{—Å–ø.–º}} = [t]_{{–∑–ª}} - t_{{–æ–ø–µ—Ä}} = {t_zl_max} - {t_oper} = {t_sp_m} \ c$$
    3.  **–ü–æ—á–∞—Ç–∫–æ–≤–∏–π –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –≤–∏—Ç—Ä–∞—Ç–∏:**
        $$\phi_{{—Å–∏—Å—Ç}} = 1 / \sqrt{{\zeta_c}} = {phi_syst_init:.3f}$$
    4.  **–ß–∏—Å–ª–æ –†–µ–π–Ω–æ–ª—å–¥—Å–∞:**
        $$Re = \\frac{{w \\cdot d_{{–≤–Ω}} \\cdot \\rho}}{{\mu}} = {Re:.2f}$$
    5.  **–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –æ–ø–æ—Ä—É —Å–∏—Å—Ç–µ–º–∏ (–∑ —Ç–µ—Ä—Ç—è–º):**
        $$\zeta_{{—Å–∏—Å—Ç}} = \zeta_c + (\\lambda / d_{{–≤–Ω}}) \\cdot \sum L_i = {zeta_syst:.3f}$$
    6.  **–£—Ç–æ—á–Ω–µ–Ω–∏–π –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –≤–∏—Ç—Ä–∞—Ç–∏:**
        $$\phi'_{{—Å–∏—Å—Ç}} = {phi_syst_new:.3f}$$
    7.  **–§–∞–∫—Ç–∏—á–Ω–∏–π —á–∞—Å —Å–ø–æ—Ä–æ–∂–Ω–µ–Ω–Ω—è:**
        $$t_{{—Å–ø–æ—Ä}} = \\frac{{2F(\sqrt{{H_1}} - \sqrt{{H_2}})}}{{\phi'_{{—Å–∏—Å—Ç}} \cdot f_{{—Ç—Ä}} \cdot \sqrt{{2g}}}} = {t_spor:.1f} \ c$$
    """)

if t_spor <= t_sp_m:
    st.success("‚úîÔ∏è –£–º–æ–≤–∞ –±–µ–∑–ø–µ–∫–∏ –≤–∏–∫–æ–Ω–∞–Ω–∞: –°–∏—Å—Ç–µ–º–∞ –≤—Å—Ç–∏–≥–∞—î —Å–ø–æ—Ä–æ–∂–Ω–∏—Ç–∏ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä —É –≤–∏–∑–Ω–∞—á–µ–Ω–∏–π —á–∞—Å.")
else:
    st.error("‚ùå –£–º–æ–≤–∞ –±–µ–∑–ø–µ–∫–∏ –ù–ï –≤–∏–∫–æ–Ω–∞–Ω–∞: –ß–∞—Å —Å–ø–æ—Ä–æ–∂–Ω–µ–Ω–Ω—è –ø–µ—Ä–µ–≤–∏—â—É—î –¥–æ–ø—É—Å—Ç–∏–º–∏–π!")
